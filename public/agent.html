<!DOCTYPE html>
<html>
<head>
  <title>Agent Panel</title>
  <script src="https://sdk.twilio.com/js/voice/latest/twilio.min.js"></script>
</head>
<body>

<h2>Agent Login</h2>

<select id="identity">
  <option value="diego">Diego</option>
  <option value="colombia">Colombia</option>
</select>

<button id="goOnline">Go Online</button>

<p id="status">Offline</p>

<script>
let device;

document.getElementById("goOnline").addEventListener("click", async () => {

  const identity = document.getElementById("identity").value;

  const response = await fetch(`https://twilio-backend-ncbh.onrender.com/token?identity=${identity}`);
  const data = await response.json();

  device = new Twilio.Device(data.token);

  device.on("ready", () => {
    document.getElementById("status").innerText = identity + " is ONLINE";
  });

  device.on("incoming", call => {
    call.accept();
  });

});
</script>

</body>
</html>
